<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bộ đếm TikTok</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        #countdown {
            font-size: 48px;
            margin-top: 20px;
            color: #000;
        }
        #info {
            font-size: 24px;
            margin-top: 10px;
        }
        #loading {
            color: gray;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <h1>Bộ đếm TikTok</h1>

    <!-- Hiển thị TikTok ID -->
    <div id="info">
        TikTok ID: <span id="tiktok-id">Đang tải...</span><br>
        Rương: <span id="box-info">Đang tải...</span>
    </div>

    <!-- Hiển thị bộ đếm -->
    <div id="countdown">Đang tải...</div>

    <script>
        const ws = new WebSocket('wss://' + window.location.host);

        const tiktokIdElement = document.getElementById('tiktok-id');
        const boxInfoElement = document.getElementById('box-info');
        const countdownElement = document.getElementById('countdown');

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            const { remaining_time, tiktok_id, diamond_count, people_count } = data;

            // Cập nhật TikTok ID
            tiktokIdElement.textContent = tiktok_id || 'Không xác định';

            // Cập nhật thông tin rương
            boxInfoElement.textContent = `${diamond_count || 0}/${people_count || 0}`;

            // Cập nhật bộ đếm
            if (remaining_time <= 0) {
                countdownElement.innerHTML = '<span style="color: red;">Hết giờ!</span>';
            } else {
                const totalSeconds = Math.floor(remaining_time / 1000);
                const tenths = Math.floor((remaining_time % 1000) / 100);
                countdownElement.textContent = `${totalSeconds}.${tenths}`;
            }
        };

        ws.onerror = (error) => {
            console.error('WebSocket error:', error);
            countdownElement.textContent = 'Lỗi kết nối!';
        };
    </script>
</body>
</html>
